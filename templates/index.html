<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rate Alarm Extractor</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background: radial-gradient(ellipse at center, #0f0f0f 0%, #000 70%);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Animated background particles */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(2px 2px at 20px 30px, #00ffff, transparent),
                radial-gradient(2px 2px at 40px 70px, #ff0080, transparent),
                radial-gradient(1px 1px at 90px 40px, #ffff00, transparent),
                radial-gradient(1px 1px at 130px 80px, #00ff00, transparent),
                radial-gradient(2px 2px at 160px 30px, #ff4500, transparent);
            background-repeat: repeat;
            background-size: 200px 150px;
            animation: particleMove 20s linear infinite;
            opacity: 0.1;
            z-index: -1;
        }
        
        @keyframes particleMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(-200px, -150px); }
        }
        
        /* Glowing grid lines */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: -1;
            animation: gridPulse 4s ease-in-out infinite alternate;
        }
        
        @keyframes gridPulse {
            0% { opacity: 0.1; }
            100% { opacity: 0.3; }
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(10, 10, 20, 0.9);
            border-radius: 20px;
            box-shadow: 
                0 0 50px rgba(0, 255, 255, 0.3),
                inset 0 0 50px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 255, 255, 0.2);
        }
        
        .header {
            background: linear-gradient(135deg, 
                rgba(0, 255, 255, 0.2) 0%, 
                rgba(255, 0, 128, 0.2) 50%, 
                rgba(0, 255, 0, 0.2) 100%);
            color: #ffffff;
            padding: 40px;
            text-align: center;
            position: relative;
            border-bottom: 2px solid rgba(0, 255, 255, 0.3);
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(0, 255, 255, 0.1), transparent);
            animation: headerSweep 3s ease-in-out infinite;
        }
        
        @keyframes headerSweep {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .header h1 {
            font-family: 'Orbitron', monospace;
            font-size: 3em;
            font-weight: 900;
            margin-bottom: 15px;
            text-shadow: 
                0 0 10px rgba(0, 255, 255, 0.8),
                0 0 20px rgba(0, 255, 255, 0.4),
                0 0 30px rgba(0, 255, 255, 0.2);
            animation: titleGlow 2s ease-in-out infinite alternate;
            position: relative;
            z-index: 1;
        }
        
        @keyframes titleGlow {
            0% { text-shadow: 0 0 10px rgba(0, 255, 255, 0.8), 0 0 20px rgba(0, 255, 255, 0.4); }
            100% { text-shadow: 0 0 15px rgba(0, 255, 255, 1), 0 0 25px rgba(0, 255, 255, 0.6); }
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            font-weight: 400;
            position: relative;
            z-index: 1;
            color: #cccccc;
        }
        
        .content {
            padding: 40px;
        }
        
        .upload-section {
            background: linear-gradient(145deg, rgba(20, 20, 40, 0.8), rgba(40, 20, 60, 0.6));
            border: 2px dashed rgba(0, 255, 255, 0.5);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.4s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .upload-section::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, 
                transparent, 
                rgba(0, 255, 255, 0.5), 
                transparent, 
                rgba(255, 0, 128, 0.5), 
                transparent);
            border-radius: 15px;
            z-index: -1;
            animation: borderRotate 3s linear infinite;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .upload-section:hover::before {
            opacity: 1;
        }
        
        @keyframes borderRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .upload-section:hover {
            background: linear-gradient(145deg, rgba(30, 30, 50, 0.9), rgba(50, 30, 70, 0.8));
            border-color: rgba(0, 255, 255, 0.8);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.3);
        }
        
        .upload-section.dragover {
            background: linear-gradient(145deg, rgba(0, 255, 255, 0.1), rgba(255, 0, 128, 0.1));
            border-color: #00ffff;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
        }
        
        .upload-icon {
            font-size: 4em;
            color: #00ffff;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 10px rgba(0, 255, 255, 0.8));
            animation: iconFloat 3s ease-in-out infinite;
        }
        
        @keyframes iconFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .upload-text {
            font-size: 1.4em;
            color: #ffffff;
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        .file-input {
            display: none;
        }
        
        .upload-btn {
            background: linear-gradient(135deg, #00ffff 0%, #ff0080 100%);
            color: #000;
            border: none;
            padding: 15px 35px;
            border-radius: 30px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        .upload-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s ease;
        }
        
        .upload-btn:hover::before {
            left: 100%;
        }
        
        .upload-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 255, 255, 0.4);
        }
        
        .warning-note {
            background: linear-gradient(135deg, rgba(255, 165, 0, 0.1), rgba(255, 69, 0, 0.1));
            border: 1px solid rgba(255, 165, 0, 0.5);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #ffcc00;
            font-size: 1em;
            font-weight: 500;
            text-align: left;
        }
        
        .warning-note::before {
            content: '‚ö†Ô∏è ';
            font-size: 1.2em;
            margin-right: 10px;
        }
        
        .file-info {
            background: linear-gradient(135deg, rgba(0, 255, 0, 0.1), rgba(0, 128, 255, 0.1));
            border: 1px solid rgba(0, 255, 0, 0.5);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            display: none;
            color: #00ff88;
        }
        
        .progress-section {
            margin: 30px 0;
            display: none;
        }
        
        .progress-container {
            background: rgba(20, 20, 40, 0.8);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            border: 1px solid rgba(0, 255, 255, 0.3);
        }
        
        .progress-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.5em;
            color: #00ffff;
            margin-bottom: 25px;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }
        
        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(40, 40, 60, 0.8);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
            position: relative;
        }
        
        .progress-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                rgba(0, 255, 255, 0.2) 0%, 
                rgba(0, 255, 255, 0.1) 50%, 
                rgba(0, 255, 255, 0.2) 100%);
            animation: progressShimmer 2s ease-in-out infinite;
        }
        
        @keyframes progressShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ffff, #ff0080, #00ff00);
            background-size: 200% 100%;
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease;
            animation: progressGradient 3s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.3), 
                transparent);
            animation: progressSweep 2s linear infinite;
        }
        
        @keyframes progressGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes progressSweep {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .progress-status {
            color: #ffffff;
            font-size: 1.1em;
            margin-top: 15px;
            font-weight: 500;
            animation: statusPulse 2s ease-in-out infinite;
        }
        
        @keyframes statusPulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        
        .status-message {
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            display: none;
            font-weight: 500;
        }
        
        .status-success {
            background: linear-gradient(135deg, rgba(0, 255, 0, 0.1), rgba(0, 128, 255, 0.1));
            border: 1px solid rgba(0, 255, 0, 0.5);
            color: #00ff88;
        }
        
        .status-error {
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.1), rgba(255, 69, 0, 0.1));
            border: 1px solid rgba(255, 0, 0, 0.5);
            color: #ff6666;
        }
        
        .download-section {
            background: linear-gradient(135deg, rgba(0, 255, 0, 0.05), rgba(0, 128, 255, 0.05));
            border: 1px solid rgba(0, 255, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            display: none;
        }
        
        .download-btn {
            background: linear-gradient(135deg, #00ff00 0%, #00ffff 100%);
            color: #000;
            text-decoration: none;
            padding: 18px 45px;
            border-radius: 30px;
            font-size: 1.2em;
            font-weight: 700;
            display: inline-block;
            margin: 15px;
            transition: all 0.3s ease;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        .download-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s ease;
        }
        
        .download-btn:hover::before {
            left: 100%;
        }
        
        .download-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 255, 0, 0.4);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(30, 30, 50, 0.8), rgba(50, 30, 70, 0.6));
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(0, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 255, 255, 0.3);
            border-color: rgba(0, 255, 255, 0.5);
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(135deg, #00ffff, #ff0080);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-family: 'Orbitron', monospace;
        }
        
        .stat-label {
            color: #cccccc;
            font-size: 0.9em;
            margin-top: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .format-info {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.05), rgba(255, 0, 128, 0.05));
            border: 1px solid rgba(0, 255, 255, 0.2);
            padding: 15px;
            margin-top: 30px;
            border-radius: 10px;
            text-align: center;
            color: #cccccc;
            font-size: 0.95em;
        }
        
        .reset-btn {
            background: linear-gradient(135deg, #666666 0%, #999999 100%);
            color: #fff;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .reset-btn:hover {
            background: linear-gradient(135deg, #777777 0%, #aaaaaa 100%);
            transform: translateY(-2px);
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .content {
                padding: 25px;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
            
            .upload-section {
                padding: 25px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
        }
        
        /* Smooth scroll and selection styling */
        ::selection {
            background: rgba(0, 255, 255, 0.3);
            color: #ffffff;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(20, 20, 40, 0.8);
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #00ffff, #ff0080);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #00cccc, #cc0066);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Rate Alarm Extractor</h1>
            <p>Created by Dumith.D - ¬© All rights reserved 2025</p>
        </div>
        
        <div class="content">
            <div class="upload-section" id="uploadSection">
                <div class="upload-icon">‚ö°</div>
                <div class="upload-text">
                    <strong>Drop your Excel file here</strong><br>
                    or click to browse
                </div>
                <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls">
                <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                    Select Excel File
                </button>
            </div>
            
            <div class="warning-note">
                <strong>Required Columns:</strong> Columns "name", "Alarm Source", "Location Info", "Arrived On (ST)", "Other Information" must be available on the current alarm window. If not available please add the columns before exporting the excel file.
            </div>
            
            <div class="file-info" id="fileInfo">
                <strong>üìÑ Selected File:</strong> <span id="fileName"></span><br>
                <strong>üìè Size:</strong> <span id="fileSize"></span>
            </div>
            
            <div class="progress-section" id="progressSection">
                <div class="progress-container">
                    <div class="progress-title">Processing Data...</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-status" id="progressStatus">Initializing...</div>
                </div>
            </div>
            
            <div class="status-message" id="statusMessage"></div>
            
            <div class="download-section" id="downloadSection">
                <h3>‚úÖ Processing Complete!</h3>
                
                <div class="stats-grid" id="statsGrid">
                    <!-- Stats will be populated here -->
                </div>
                
                <div>
                    <a href="#" class="download-btn" id="downloadBtn">
                        ‚¨áÔ∏è Download Result
                    </a>
                    <button class="reset-btn" onclick="resetApp()">
                        üîÑ Process Another File
                    </button>
                </div>
            </div>
            
            <div class="format-info">
                <strong>Supported formats:</strong> .xlsx, .xls | <strong>Max size:</strong> 16MB
            </div>
        </div>
    </div>

    <script>
        const uploadSection = document.getElementById('uploadSection');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const progressSection = document.getElementById('progressSection');
        const progressFill = document.getElementById('progressFill');
        const progressStatus = document.getElementById('progressStatus');
        const statusMessage = document.getElementById('statusMessage');
        const downloadSection = document.getElementById('downloadSection');
        const downloadBtn = document.getElementById('downloadBtn');
        const statsGrid = document.getElementById('statsGrid');

        // Drag and drop functionality
        uploadSection.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadSection.classList.add('dragover');
        });

        uploadSection.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadSection.classList.remove('dragover');
        });

        uploadSection.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadSection.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        uploadSection.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            // Validate file type
            if (!file.name.toLowerCase().match(/\.(xlsx|xls)$/)) {
                showStatus('Please select a valid Excel file (.xlsx or .xls)', 'error');
                return;
            }

            // Validate file size (16MB limit)
            if (file.size > 16 * 1024 * 1024) {
                showStatus('File size exceeds 16MB limit. Please select a smaller file.', 'error');
                return;
            }

            // Show file info
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            fileInfo.style.display = 'block';

            // Start upload and processing
            uploadFile(file);
        }

        function uploadFile(file) {
            const formData = new FormData();
            formData.append('file', file);

            // Show progress
            progressSection.style.display = 'block';
            uploadSection.style.display = 'none';
            
            // Enhanced progress simulation
            const progressSteps = [
                { progress: 10, message: 'Uploading file to server...' },
                { progress: 25, message: 'Reading Excel structure...' },
                { progress: 45, message: 'Filtering alarm data...' },
                { progress: 65, message: 'Extracting node information...' },
                { progress: 80, message: 'Processing duplicates...' },
                { progress: 95, message: 'Finalizing output table...' },
                { progress: 100, message: 'Complete!' }
            ];

            let stepIndex = 0;
            const progressInterval = setInterval(() => {
                if (stepIndex < progressSteps.length) {
                    const step = progressSteps[stepIndex];
                    progressFill.style.width = step.progress + '%';
                    progressStatus.textContent = step.message;
                    stepIndex++;
                }
            }, 800);

            // Send request to server
            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                clearInterval(progressInterval);
                progressSection.style.display = 'none';

                if (data.success) {
                    showDownloadSection(data);
                } else {
                    showStatus(data.error, 'error');
                    resetUploadSection();
                }
            })
            .catch(error => {
                clearInterval(progressInterval);
                progressSection.style.display = 'none';
                showStatus('Network error: ' + error.message, 'error');
                resetUploadSection();
            });
        }

        function showDownloadSection(data) {
            downloadSection.style.display = 'block';
            downloadBtn.href = data.download_url;

            // Show statistics with enhanced styling
            if (data.stats) {
                statsGrid.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${data.stats.total_rows}</div>
                        <div class="stat-label">Total Records</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${data.stats.node_b_count}</div>
                        <div class="stat-label">Node B Extracted</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${data.stats.link_desc_count}</div>
                        <div class="stat-label">Link Descriptions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${data.stats.utilization_count}</div>
                        <div class="stat-label">Utilization Data</div>
                    </div>
                `;
            }

            showStatus(data.message, 'success');
        }

        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message status-${type}`;
            statusMessage.style.display = 'block';

            // Auto-hide success messages after 5 seconds
            if (type === 'success') {
                setTimeout(() => {
                    statusMessage.style.display = 'none';
                }, 5000);
            }
        }

        function resetUploadSection() {
            uploadSection.style.display = 'block';
            fileInfo.style.display = 'none';
        }

        function resetApp() {
            // Reset all sections
            uploadSection.style.display = 'block';
            fileInfo.style.display = 'none';
            progressSection.style.display = 'none';
            statusMessage.style.display = 'none';
            downloadSection.style.display = 'none';
            
            // Clear file input
            fileInput.value = '';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Enhanced user interactions
        document.addEventListener('DOMContentLoaded', function() {
            // Add enhanced hover effects
            const buttons = document.querySelectorAll('button, .download-btn');
            buttons.forEach(button => {
                button.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-3px)';
                });
                
                button.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });

            // Prevent default drag behaviors on document
            document.addEventListener('dragover', (e) => e.preventDefault());
            document.addEventListener('drop', (e) => e.preventDefault());

            // Add particle effect on successful upload
            window.createParticles = function() {
                for (let i = 0; i < 50; i++) {
                    const particle = document.createElement('div');
                    particle.style.position = 'fixed';
                    particle.style.width = '4px';
                    particle.style.height = '4px';
                    particle.style.background = `hsl(${Math.random() * 360}, 70%, 60%)`;
                    particle.style.borderRadius = '50%';
                    particle.style.pointerEvents = 'none';
                    particle.style.zIndex = '9999';
                    particle.style.left = Math.random() * window.innerWidth + 'px';
                    particle.style.top = Math.random() * window.innerHeight + 'px';
                    
                    document.body.appendChild(particle);
                    
                    const animation = particle.animate([
                        { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                        { transform: `translate(${(Math.random() - 0.5) * 200}px, ${(Math.random() - 0.5) * 200}px) scale(0)`, opacity: 0 }
                    ], {
                        duration: 2000,
                        easing: 'ease-out'
                    });
                    
                    animation.onfinish = () => particle.remove();
                }
            };
        });

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl+U or Cmd+U to trigger file upload
            if ((e.ctrlKey || e.metaKey) && e.key === 'u') {
                e.preventDefault();
                fileInput.click();
            }
            
            // Escape to reset
            if (e.key === 'Escape') {
                resetApp();
            }
        });

        // Add window beforeunload handler to warn about unsaved work
        let processingInProgress = false;
        
        window.addEventListener('beforeunload', function(e) {
            if (processingInProgress) {
                e.preventDefault();
                e.returnValue = 'Processing is in progress. Are you sure you want to leave?';
                return e.returnValue;
            }
        });

        // Update processing state
        function setProcessingState(processing) {
            processingInProgress = processing;
        }

        // Enhanced showDownloadSection with particle effect
        const originalShowDownloadSection = showDownloadSection;
        showDownloadSection = function(data) {
            originalShowDownloadSection(data);
            // Trigger particle celebration effect
            if (window.createParticles) {
                window.createParticles();
            }
        };
    </script>
</body>
</html>